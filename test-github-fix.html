<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test GitHub Pages Fix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .status { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .btn { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test GitHub Pages Fix v2.1.3</h1>
        
        <div id="version-check" class="status info">
            <strong>Versi√≥n detectada:</strong> <span id="version-display">Verificando...</span>
        </div>
        
        <div id="environment-check" class="status info">
            <strong>Entorno:</strong> <span id="env-display">Verificando...</span>
        </div>
        
        <div id="api-status" class="status info">
            <strong>Estado API:</strong> <span id="api-display">No probado</span>
        </div>
        
        <button class="btn" onclick="testAPI()">üß™ Probar Env√≠o de Voto</button>
        
        <h3>üìã Logs:</h3>
        <pre id="logs"></pre>
    </div>

    <script>
        let logs = [];
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            logs.push(logMessage);
            document.getElementById('logs').textContent = logs.join('\n');
            console.log(logMessage);
        }
        
        // Verificar versi√≥n
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Iniciando test...');
            
            // Detectar entorno
            const isGitHubPages = window.location.hostname.includes('github.io');
            document.getElementById('env-display').textContent = isGitHubPages ? 
                'üåê GitHub Pages' : 'üè† Local';
            
            // Mostrar versi√≥n
            document.getElementById('version-display').textContent = 'v2.1.3-PROXY-FIX';
            
            log(`Entorno: ${isGitHubPages ? 'GitHub Pages' : 'Local'}`);
            log('Versi√≥n: v2.1.3-PROXY-FIX');
        });
        
        async function testAPI() {
            log('üß™ Iniciando test de API...');
            document.getElementById('api-display').textContent = 'Probando...';
            
            const testData = {
                email: 'test-github-fix@foundever.com',
                totalHours: 42,
                selectedQuestions: '1. test-question (Low) - 42h'
            };
            
            try {
                // Probar con proxy CORS alternativo
                const proxyUrl = 'https://corsproxy.io/?';
                const apiUrl = `http://44.223.24.11/api-simple.php?action=submit&email=${encodeURIComponent(testData.email)}&totalHours=${testData.totalHours}&selectedQuestions=${encodeURIComponent(testData.selectedQuestions)}`;
                log(`üì° Conectando v√≠a proxy: ${proxyUrl}`);
                
                const response = await fetch(`${proxyUrl}${encodeURIComponent(apiUrl)}`);
                
                log(`üìä Respuesta HTTP: ${response.status}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                log(`‚úÖ Respuesta JSON: ${JSON.stringify(result)}`);
                
                if (result.success) {
                    document.getElementById('api-status').className = 'status success';
                    document.getElementById('api-display').textContent = `‚úÖ √âxito! ID: ${result.id}`;
                    log(`üéâ ¬°Voto guardado exitosamente! ID: ${result.id}`);
                } else {
                    throw new Error(result.error || 'Error desconocido');
                }
                
            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
                document.getElementById('api-status').className = 'status error';
                document.getElementById('api-display').textContent = `‚ùå Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>

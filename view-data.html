<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprint 24 - View Data</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .stats { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .button:hover { background: #0056b3; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f8f9fa; }
        .no-data { text-align: center; color: #666; padding: 40px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä Sprint 24 - Submitted Data</h1>
        <button class="button" onclick="loadData()">üîÑ Refresh Data</button>
        <button class="button" onclick="exportCSV()">üìÑ Export CSV</button>
        <button class="button" onclick="clearData()">üóëÔ∏è Clear All Data</button>
    </div>
    
    <div id="stats" class="stats"></div>
    <div id="data-table"></div>
    
    <script>
        function loadData() {
            const data = JSON.parse(localStorage.getItem('sprint24_submissions') || '[]');
            
            if (data.length === 0) {
                document.getElementById('stats').innerHTML = '<div class="no-data">No data found. Submit some forms first!</div>';
                document.getElementById('data-table').innerHTML = '';
                return;
            }
            
            // Show stats
            const totalHours = data.reduce((sum, s) => sum + s.totalHours, 0);
            const avgHours = Math.round(totalHours / data.length);
            
            document.getElementById('stats').innerHTML = `
                <h3>üìà Statistics</h3>
                <p><strong>Total Submissions:</strong> ${data.length}</p>
                <p><strong>Total Hours:</strong> ${totalHours}h</p>
                <p><strong>Average Hours:</strong> ${avgHours}h per submission</p>
                <p><strong>Last Submission:</strong> ${new Date(data[data.length-1].submissionDate).toLocaleString()}</p>
            `;
            
            // Show table
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Date</th>
                            <th>Items</th>
                            <th>Hours</th>
                            <th>Capacity</th>
                            <th>Selected Items (with Priority)</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            data.forEach(submission => {
                const items = submission.selectedItems.map(item => 
                    `${item.questionNumber || '?'}. ${item.title} (${item.hours}h) [${item.priority || 'No Priority'}]`
                ).join(', ');
                tableHTML += `
                    <tr>
                        <td>${submission.email}</td>
                        <td>${new Date(submission.submissionDate).toLocaleString()}</td>
                        <td>${submission.selectedItems.length}</td>
                        <td>${submission.totalHours}h</td>
                        <td>${submission.capacityUsed}%</td>
                        <td style="max-width: 300px; word-wrap: break-word;">${items}</td>
                    </tr>
                `;
            });
            
            tableHTML += '</tbody></table>';
            document.getElementById('data-table').innerHTML = tableHTML;
        }
        
        function exportCSV() {
            const data = JSON.parse(localStorage.getItem('sprint24_submissions') || '[]');
            if (data.length === 0) {
                alert('No data to export');
                return;
            }
            
            const headers = ['Email', 'Date', 'Items Count', 'Total Hours', 'Capacity Used', 'Selected Items (with Priority)'];
            const rows = data.map(s => [
                s.email,
                new Date(s.submissionDate).toLocaleString(),
                s.selectedItems.length,
                s.totalHours,
                s.capacityUsed + '%',
                s.selectedItems.map(item => `${item.questionNumber || '?'}. ${item.title} (${item.hours}h) [${item.priority || 'No Priority'}]`).join('; ')
            ]);
            
            const csvContent = [headers, ...rows]
                .map(row => row.map(field => `"${field}"`).join(','))
                .join('\\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `sprint24-data-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function clearData() {
            if (confirm('Are you sure you want to delete all data?')) {
                localStorage.removeItem('sprint24_submissions');
                loadData();
                alert('All data cleared!');
            }
        }
        
        // Load data on page load
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
